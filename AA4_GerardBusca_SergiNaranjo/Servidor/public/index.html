<!DOCTYPE html>
<html>
<head>
  <title>Tetris Online</title>
</head>
<body>

  <!-- Login -->
  <div id="loginDiv">
    <h1>Login</h1>
    <input type="text" id="username" placeholder="Usuario">
    <input type="password" id="password" placeholder="Contraseña">
    <button id="loginBtn">Entrar</button>
    <p id="error" style="color:red;"></p>
  </div>

  <!-- Juego -->
  <div id="gameDiv" style="display:none;">
    <h1 id="roomMessage">Welcome to Tetris Online!</h1>

    <input type="text" id="roomName" placeholder="Nombre de la sala">
    <button id="joinBtn">Unirse a la sala</button>

    <p><strong>Controles:</strong> ⬅ ⬆ ➡ ⬇</p>

    <p>Jugadores en sala: <span id="players">0</span></p>
    <button id="leaveBtn" style="display:none;">Salir de la sala</button>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();
    let inRoom = false;

    // Enviar movimiento al servidor
    function sendMove(direction) {
      console.log("Enviando movimiento:", direction);
      socket.emit("playerMove", direction);
    }

    // LOGIN
    document.getElementById("loginBtn").addEventListener("click", () => {
      const username = document.getElementById("username").value.trim();
      const password = document.getElementById("password").value.trim();

      if (username === "admin" && password === "1234") {
        document.getElementById("loginDiv").style.display = "none";
        document.getElementById("gameDiv").style.display = "block";
      } else {
        document.getElementById("error").innerText = "Login incorrecto";
      }
    });

    // UNIRSE A SALA
    document.getElementById("joinBtn").addEventListener("click", () => {
      const roomName = document.getElementById("roomName").value.trim();
      if (!roomName) return alert("Debes escribir el nombre de la sala");

      socket.emit("joinRoom", { roomName });
    });

    // SALIR DE SALA
    document.getElementById("leaveBtn").addEventListener("click", () => {
      const roomName = document.getElementById("roomName").value.trim();

      socket.emit("leaveRoom", { roomName });

      inRoom = false;
      document.getElementById("leaveBtn").style.display = "none";
      document.getElementById("roomMessage").innerText = "Welcome to Tetris Online!";
      document.getElementById("players").innerText = "0";

      alert("Has salido de la sala");
    });

    // ACTUALIZACIÓN DE SALA
    socket.on("roomUpdate", ({ players }) => {
      document.getElementById("players").innerText = players;
      document.getElementById("roomMessage").innerText =
        "Bienvenido a la sala " + document.getElementById("roomName").value;

      inRoom = true;
      document.getElementById("leaveBtn").style.display = "block";
    });

    // CONTROLES CON TECLADO
    document.addEventListener("keydown", (event) => {
      if (!inRoom) return;

      switch (event.key) {
        case "ArrowLeft":
          sendMove("Izquierda");
          break;
        case "ArrowRight":
          sendMove("Derecha");
          break;
        case "ArrowDown":
          sendMove("Abajo");
          break;
        case "ArrowUp":
          sendMove("Arriba"); // útil para rotar
          break;
      }
    });
  </script>

</body>
</html>