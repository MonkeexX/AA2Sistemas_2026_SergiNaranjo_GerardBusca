<!DOCTYPE html>
<html>
<head>
  <title>Tetris Online</title>
</head>
<body>
  <!-- Login -->
  <div id="loginDiv">
    <h1>Login</h1>
    <input type="text" id="username" placeholder="Usuario">
    <input type="password" id="password" placeholder="Contraseña">
    <button id="loginBtn">Entrar</button>
    <p id="error" style="color:red;"></p>
  </div>

  <!-- Juego (oculto hasta login) -->
  <div id="gameDiv" style="display:none;">
    <h1 id="roomMessage">Welcome to Tetris Online!</h1>

    <input type="text" id="roomName" placeholder="Nombre de la sala">
    <button id="joinBtn">Unirse a la sala</button>

    <div id="controls" style="display: none;">
      <button onclick="sendMove('Derecha')">Derecha</button>
      <button onclick="sendMove('Izquierda')">Izquierda</button>
      <button onclick="sendMove('Abajo')">Abajo</button>
    </div>

    <p>Jugadores en sala: <span id="players">0</span></p>
    <button id="leaveBtn" style="display:none;">Salir de la sala</button>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();

    // Función para enviar movimientos
    function sendMove(direction) {
      console.log("Enviando movimiento:", direction);
      socket.emit("playerMove", direction);           
    }

    // Manejo de login
    document.getElementById("loginBtn").addEventListener("click", async () => {
      const username = document.getElementById("username").value.trim();
      const password = document.getElementById("password").value.trim();

      // Aquí validamos "en cliente" para no instalar nada
      if(username === "admin" && password === "1234") {
        // Login correcto → mostrar juego
        document.getElementById("loginDiv").style.display = "none";
        document.getElementById("gameDiv").style.display = "block";
      } else {
        document.getElementById("error").innerText = "Login incorrecto";
      }
    });

    // Manejo de sala
    document.getElementById("joinBtn").addEventListener("click", () => {
      const roomName = document.getElementById("roomName").value.trim();
      if (!roomName) return alert("Debes escribir el nombre de la sala");

      socket.emit("joinRoom", { roomName });
    });
    document.getElementById("leaveBtn").addEventListener("click", () => {
      const roomName = document.getElementById("roomName").value.trim();

      // Avisar al servidor
      socket.emit("leaveRoom", { roomName });

      // Resetear interfaz
      document.getElementById("controls").style.display = "none";
      document.getElementById("leaveBtn").style.display = "none";
      document.getElementById("roomMessage").innerText = "Welcome to Tetris Online!";
      document.getElementById("players").innerText = "0";

      alert("Has salido de la sala");
    });

    socket.on("roomUpdate", ({ players }) => {
      document.getElementById("players").innerText = players;
      document.getElementById("roomMessage").innerText =
        "Bienvenido a la sala " + document.getElementById("roomName").value;
      document.getElementById("controls").style.display = "block";
     document.getElementById("leaveBtn").style.display = "block";
    });
    
  </script>
</body>
</html>